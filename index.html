<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Creative Assets Approval Portal</title>
    <link href="https://fonts.googleapis.com/css2?family=Segoe+UI:wght@400;600;700&display=swap" rel="stylesheet">
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            background-color: #f0f2f5;
        }
        .spinner {
            border: 3px solid #f3f3f3;
            border-top: 3px solid #1877f2;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .lightbox {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 10000;
            cursor: pointer;
        }
        .lightbox img, .lightbox video {
            max-width: 90%;
            max-height: 90%;
            object-fit: contain;
        }
        .lightbox-close {
            position: absolute;
            top: 20px;
            right: 30px;
            color: white;
            font-size: 40px;
            font-weight: bold;
            cursor: pointer;
            z-index: 10001;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        const CONFIG = {
            SHEET_ID: '1UfadxXUqOZ43zZNmsSZuR9YmMx75la4enfMzaz27eTk',
            API_KEY: 'AIzaSyABznAS0fH0tYNh6wlS_iEL08b6znNJCL8',
            CREATIVE_ASSETS_SHEET: 'Ads Masterlist',
            CLIENT_INFO_SHEET: 'Client Info',
            APPS_SCRIPT_URL: 'https://script.google.com/macros/s/AKfycbzDhiWlBQX6KuszQ-jSm_hIzmLwpNyHiwDsL-q5QKmkEr2kE_WfydLTQY0Gj-OeiirWSg/exec',

            COPIES_COLUMNS: {
                STATUS: 0,
                COPY_ID: 1,
                CAMPAIGN_NAME: 2,
                HEADLINE: 3,
                AD_COPY_TEXT: 4,
                NOTES: 9,
                LAST_UPDATED: 10
            },

            // Updated column mapping for Creative Assets sheet
            // A=Approval Status, B=Ad Status, C=Ad Name, D=Description, E=Campaign Angle,
            // F=Headline, G=Ad Copy (Body), H=GDrive Link (skip), I=Direct URL (image),
            // J=Image Text (skip), K=Client Note, L=Updated Date
            ASSETS_COLUMNS: {
                APPROVAL_STATUS: 0,    // Column A - for client approval (Pending/Approved/Needs Edit/Rejected)
                AD_STATUS: 1,          // Column B - internal Meta status (Draft/Live/Published/etc)
                AD_NAME: 2,            // Column C
                DESCRIPTION: 3,        // Column D
                CAMPAIGN_ANGLE: 4,     // Column E
                HEADLINE: 5,           // Column F
                AD_COPY_BODY: 6,       // Column G
                GDRIVE_LINK: 7,        // Column H - not used for display
                DIRECT_URL: 8,         // Column I - use this for displaying images
                IMAGE_TEXT: 9,         // Column J - not shown
                CLIENT_NOTE: 10,       // Column K
                UPDATED_DATE: 11       // Column L
            },

            CLIENT_COLUMNS: {
                CLIENT_ID: 0,
                BUSINESS_NAME: 1,
                WEBSITE_URL: 2,
                DESTINATION_URL: 3,
                PROFILE_IMAGE: 4
            },

            // Ad Status options (internal tracking - read-only in interface)
            AD_STATUSES: {
                LAUNCHED_LEADS_NO_CALLS: { label: 'Launched - Leads, No Calls', color: '#f59e0b', icon: 'üìû' },
                LAUNCHED_NO_LEADS: { label: 'Launched - No Leads', color: '#ef4444', icon: 'üìâ' },
                LIVE: { label: 'Live', color: '#10b981', icon: 'üü¢' },
                IN_DRAFT: { label: 'In Draft', color: '#6b7280', icon: 'üìù' },
                REJECTED_BY_META: { label: 'Rejected by Meta', color: '#dc2626', icon: 'üö´' },
                NOT_LAUNCHED: { label: 'Not Launched', color: '#9ca3af', icon: '‚è∏Ô∏è' }
            }
        };

        const Lightbox = ({ mediaUrl, mediaType, onClose }) => {
            const isVideo = mediaType?.toLowerCase() === 'video';

            return (
                <div className="lightbox" onClick={onClose}>
                    <span className="lightbox-close" onClick={onClose}>&times;</span>
                    {isVideo ? (
                        <video src={mediaUrl} controls autoPlay style={{ maxWidth: '90%', maxHeight: '90%' }} />
                    ) : (
                        <img src={mediaUrl} alt="Full size" />
                    )}
                </div>
            );
        };

        // Helper function to get ad status info (shared between components)
        const getAdStatusInfo = (status) => {
            const normalized = status?.toLowerCase().replace(/\s+/g, '_');
            switch(normalized) {
                case 'launched_and_got_leads_but_no_calls_booked':
                case 'launched_-_leads,_no_calls':
                case 'leads_no_calls':
                    return CONFIG.AD_STATUSES.LAUNCHED_LEADS_NO_CALLS;
                case 'launched_and_didn\'t_get_leads':
                case 'launched_and_didnt_get_leads':
                case 'launched_-_no_leads':
                case 'no_leads':
                    return CONFIG.AD_STATUSES.LAUNCHED_NO_LEADS;
                case 'live':
                    return CONFIG.AD_STATUSES.LIVE;
                case 'in_draft':
                case 'draft':
                    return CONFIG.AD_STATUSES.IN_DRAFT;
                case 'rejected_by_meta':
                case 'meta_rejected':
                    return CONFIG.AD_STATUSES.REJECTED_BY_META;
                case 'not_launched':
                    return CONFIG.AD_STATUSES.NOT_LAUNCHED;
                default:
                    return CONFIG.AD_STATUSES.NOT_LAUNCHED;
            }
        };

        const CreativeAssetCard = ({ asset, clientInfo, updating, onStatusUpdate, editNotes, onNotesChange }) => {
            const [mediaError, setMediaError] = useState(false);
            const [showLightbox, setShowLightbox] = useState(false);
            const [isExpanded, setIsExpanded] = useState(false);

            const isVideo = asset.assetUrl?.toLowerCase().includes('video') ||
                           asset.assetUrl?.toLowerCase().endsWith('.mp4') ||
                           asset.assetUrl?.toLowerCase().endsWith('.mov');

            const getStatusColor = (status) => {
                switch(status?.toLowerCase()) {
                    case 'approved': return '#10b981';
                    case 'needs edit': return '#f59e0b';
                    case 'rejected': return '#ef4444';
                    default: return '#e4e6eb';
                }
            };

            const adStatusInfo = getAdStatusInfo(asset.adStatus);
            const adCopyText = asset.adCopyBody || '';
            const shouldTruncate = adCopyText.length > 150;
            const displayUrl = clientInfo?.websiteUrl?.replace(/^https?:\/\//, '').replace(/\/$/, '') || 'example.com';

            return (
                <>
                    <div style={{
                        backgroundColor: 'white',
                        borderRadius: '8px',
                        overflow: 'hidden',
                        boxShadow: '0 1px 2px rgba(0, 0, 0, 0.1)',
                        border: `2px solid ${getStatusColor(asset.approvalStatus)}`
                    }}>
                        {/* Facebook-style Header with Profile */}
                        <div style={{
                            padding: '12px',
                            display: 'flex',
                            alignItems: 'center',
                            gap: '10px',
                            borderBottom: '1px solid #e4e6eb'
                        }}>
                            {/* Profile Image */}
                            <div style={{
                                width: '40px',
                                height: '40px',
                                borderRadius: '50%',
                                backgroundColor: '#e4e6eb',
                                overflow: 'hidden',
                                flexShrink: 0
                            }}>
                                {clientInfo?.profileImage ? (
                                    <img
                                        src={clientInfo.profileImage}
                                        alt={clientInfo.businessName}
                                        style={{ width: '100%', height: '100%', objectFit: 'cover' }}
                                        onError={(e) => { e.target.style.display = 'none'; }}
                                    />
                                ) : (
                                    <div style={{
                                        width: '100%',
                                        height: '100%',
                                        display: 'flex',
                                        alignItems: 'center',
                                        justifyContent: 'center',
                                        backgroundColor: '#1877f2',
                                        color: 'white',
                                        fontSize: '18px',
                                        fontWeight: '600'
                                    }}>
                                        {(clientInfo?.businessName || 'C').charAt(0).toUpperCase()}
                                    </div>
                                )}
                            </div>

                            {/* Name and Sponsored */}
                            <div style={{ flex: 1 }}>
                                <div style={{
                                    fontSize: '14px',
                                    fontWeight: '600',
                                    color: '#050505'
                                }}>
                                    {clientInfo?.businessName || 'Client Name'}
                                </div>
                                <div style={{
                                    fontSize: '12px',
                                    color: '#65676b'
                                }}>
                                    Sponsored
                                </div>
                            </div>

                            {/* Ad Status Badge - Read Only */}
                            <div style={{
                                backgroundColor: adStatusInfo.color,
                                color: 'white',
                                padding: '4px 10px',
                                borderRadius: '12px',
                                fontSize: '11px',
                                fontWeight: '600',
                                textTransform: 'uppercase',
                                letterSpacing: '0.3px'
                            }}>
                                {adStatusInfo.icon} {adStatusInfo.label}
                            </div>
                        </div>

                        {/* Ad Copy Text */}
                        {adCopyText && (
                            <div style={{ padding: '12px', paddingBottom: '8px' }}>
                                <div style={{
                                    fontSize: '14px',
                                    color: '#050505',
                                    lineHeight: '1.5',
                                    whiteSpace: 'pre-wrap'
                                }}>
                                    {shouldTruncate && !isExpanded ? (
                                        <>
                                            {adCopyText.substring(0, 280)}...{' '}
                                            <span
                                                onClick={() => setIsExpanded(true)}
                                                style={{
                                                    color: '#65676b',
                                                    fontWeight: '600',
                                                    cursor: 'pointer'
                                                }}
                                            >
                                                See more
                                            </span>
                                        </>
                                    ) : (
                                        <>
                                            {adCopyText}
                                            {shouldTruncate && isExpanded && (
                                                <>
                                                    {' '}
                                                    <span
                                                        onClick={() => setIsExpanded(false)}
                                                        style={{
                                                            color: '#65676b',
                                                            fontWeight: '600',
                                                            cursor: 'pointer'
                                                        }}
                                                    >
                                                        See less
                                                    </span>
                                                </>
                                            )}
                                        </>
                                    )}
                                </div>
                            </div>
                        )}

                        {/* Creative Image/Video */}
                        <div
                            style={{
                                width: '100%',
                                minHeight: '200px',
                                backgroundColor: '#f0f2f5',
                                display: 'flex',
                                alignItems: 'center',
                                justifyContent: 'center',
                                cursor: asset.assetUrl && !mediaError ? 'pointer' : 'default',
                                position: 'relative'
                            }}
                            onClick={() => {
                                if (asset.assetUrl && !mediaError) {
                                    setShowLightbox(true);
                                }
                            }}
                        >
                            {asset.assetUrl && !mediaError ? (
                                isVideo ? (
                                    <video
                                        src={asset.assetUrl}
                                        style={{
                                            width: '100%',
                                            maxHeight: '500px',
                                            objectFit: 'contain'
                                        }}
                                        onError={() => setMediaError(true)}
                                    />
                                ) : (
                                    <img
                                        src={asset.assetUrl}
                                        alt={asset.adName}
                                        style={{
                                            width: '100%',
                                            maxHeight: '500px',
                                            objectFit: 'contain'
                                        }}
                                        onError={() => setMediaError(true)}
                                    />
                                )
                            ) : asset.assetUrl && mediaError ? (
                                <div style={{ textAlign: 'center', padding: '20px', color: '#65676b' }}>
                                    <div style={{ fontSize: '48px', marginBottom: '8px' }}>üñºÔ∏è</div>
                                    <div style={{ fontSize: '14px', marginBottom: '8px' }}>
                                        Failed to load media
                                    </div>
                                    <a
                                        href={asset.assetUrl}
                                        target="_blank"
                                        rel="noopener noreferrer"
                                        style={{ fontSize: '12px', color: '#1877f2', textDecoration: 'underline' }}
                                        onClick={(e) => e.stopPropagation()}
                                    >
                                        Open link directly
                                    </a>
                                </div>
                            ) : (
                                <div style={{ textAlign: 'center', color: '#65676b' }}>
                                    <div style={{ fontSize: '48px', marginBottom: '8px' }}>
                                        {isVideo ? 'üé•' : 'üì∑'}
                                    </div>
                                    <div style={{ fontSize: '14px' }}>No media</div>
                                </div>
                            )}
                        </div>

                        {/* URL Preview Bar */}
                        <div style={{
                            padding: '12px',
                            backgroundColor: '#f0f2f5',
                            borderTop: '1px solid #e4e6eb',
                            display: 'flex',
                            alignItems: 'center',
                            justifyContent: 'space-between',
                            gap: '12px'
                        }}>
                            <div style={{ flex: 1 }}>
                                <div style={{
                                    fontSize: '12px',
                                    color: '#65676b',
                                    textTransform: 'uppercase',
                                    marginBottom: '4px'
                                }}>
                                    {displayUrl}
                                </div>
                                <div style={{
                                    fontSize: '15px',
                                    fontWeight: '600',
                                    color: '#050505',
                                    lineHeight: '1.3'
                                }}>
                                    {asset.headline || asset.adName || 'Ad Headline'}
                                </div>
                            </div>
                            <button style={{
                                padding: '8px 16px',
                                backgroundColor: '#e4e6eb',
                                color: '#050505',
                                border: 'none',
                                borderRadius: '6px',
                                fontSize: '14px',
                                fontWeight: '600',
                                cursor: 'default',
                                whiteSpace: 'nowrap',
                                flexShrink: 0
                            }}>
                                Learn more
                            </button>
                        </div>

                        {/* Engagement Buttons Row (Facebook style - decorative) */}
                        <div style={{
                            display: 'flex',
                            justifyContent: 'space-around',
                            padding: '8px 12px',
                            borderTop: '1px solid #e4e6eb',
                            borderBottom: '1px solid #e4e6eb'
                        }}>
                            {['üëç Like', 'üí¨ Comment', '‚ÜóÔ∏è Share'].map((action, idx) => (
                                <div
                                    key={idx}
                                    style={{
                                        flex: 1,
                                        textAlign: 'center',
                                        padding: '8px',
                                        fontSize: '13px',
                                        color: '#65676b',
                                        fontWeight: '600'
                                    }}
                                >
                                    {action}
                                </div>
                            ))}
                        </div>

                        {/* Feedback Notes Section */}
                        <div style={{ padding: '12px' }}>
                            <div style={{
                                fontSize: '12px',
                                fontWeight: '600',
                                color: '#65676b',
                                marginBottom: '8px',
                                textTransform: 'uppercase'
                            }}>
                                Feedback Notes
                            </div>
                            <textarea
                                placeholder="Add feedback notes (optional)..."
                                value={editNotes[asset.rowIndex] || asset.clientNote || ''}
                                onChange={(e) => onNotesChange(asset.rowIndex, e.target.value)}
                                disabled={updating[asset.rowIndex]}
                                style={{
                                    width: '100%',
                                    minHeight: '70px',
                                    padding: '10px',
                                    borderRadius: '8px',
                                    border: '1px solid #e4e6eb',
                                    fontSize: '14px',
                                    fontFamily: 'inherit',
                                    resize: 'vertical',
                                    backgroundColor: '#f0f2f5',
                                    opacity: updating[asset.rowIndex] ? 0.5 : 1
                                }}
                            />
                        </div>

                        {/* Approval Buttons */}
                        <div style={{
                            display: 'grid',
                            gridTemplateColumns: '1fr 1fr 1fr',
                            gap: '8px',
                            padding: '0 12px 12px 12px'
                        }}>
                            {[
                                { label: 'Approve', icon: '‚úì', status: 'Approved', color: '#10b981' },
                                { label: 'Edit', icon: '‚úèÔ∏è', status: 'Needs Edit', color: '#f59e0b' },
                                { label: 'Reject', icon: '‚úó', status: 'Rejected', color: '#ef4444' }
                            ].map((btn, idx) => (
                                <button
                                    key={idx}
                                    onClick={() => onStatusUpdate(asset, btn.status)}
                                    disabled={updating[asset.rowIndex]}
                                    style={{
                                        padding: '10px 8px',
                                        backgroundColor: updating[asset.rowIndex] ? '#ccc' : btn.color,
                                        color: 'white',
                                        border: 'none',
                                        borderRadius: '6px',
                                        fontSize: '13px',
                                        fontWeight: '600',
                                        cursor: updating[asset.rowIndex] ? 'not-allowed' : 'pointer',
                                        display: 'flex',
                                        alignItems: 'center',
                                        justifyContent: 'center',
                                        gap: '4px',
                                        transition: 'opacity 0.2s'
                                    }}
                                    onMouseOver={(e) => { if (!updating[asset.rowIndex]) e.target.style.opacity = '0.9'; }}
                                    onMouseOut={(e) => { e.target.style.opacity = '1'; }}
                                >
                                    {updating[asset.rowIndex] ? '‚è≥' : `${btn.icon} ${btn.label}`}
                                </button>
                            ))}
                        </div>
                    </div>

                    {showLightbox && (
                        <Lightbox
                            mediaUrl={asset.assetUrl}
                            mediaType={isVideo ? 'video' : 'image'}
                            onClose={() => setShowLightbox(false)}
                        />
                    )}
                </>
            );
        };

        const CreativeApprovalPortal = () => {
            const [creativeAssets, setCreativeAssets] = useState([]);
            const [clientInfo, setClientInfo] = useState(null);
            const [loading, setLoading] = useState(true);
            const [error, setError] = useState(null);
            const [editNotes, setEditNotes] = useState({});
            const [updating, setUpdating] = useState({});
            const [activeFilter, setActiveFilter] = useState('all');
            const [adStatusFilter, setAdStatusFilter] = useState('all');

            useEffect(() => {
                fetchData();
            }, []);

            const fetchData = async () => {
                try {
                    setLoading(true);
                    setError(null);

                    const [assetsResponse, clientResponse] = await Promise.all([
                        fetch(`https://sheets.googleapis.com/v4/spreadsheets/${CONFIG.SHEET_ID}/values/${CONFIG.CREATIVE_ASSETS_SHEET}?key=${CONFIG.API_KEY}`),
                        fetch(`https://sheets.googleapis.com/v4/spreadsheets/${CONFIG.SHEET_ID}/values/${CONFIG.CLIENT_INFO_SHEET}?key=${CONFIG.API_KEY}`)
                    ]);

                    if (!assetsResponse.ok || !clientResponse.ok) {
                        throw new Error('Failed to fetch data from Google Sheets');
                    }

                    const assetsData = await assetsResponse.json();
                    const clientData = await clientResponse.json();

                    let extractedClientInfo = {
                        businessName: '', websiteUrl: '', destinationUrl: '', profileImage: ''
                    };

                    if (clientData.values && clientData.values.length > 1) {
                        const clientRow = clientData.values[1];
                        extractedClientInfo = {
                            businessName: clientRow[CONFIG.CLIENT_COLUMNS.BUSINESS_NAME] || '',
                            websiteUrl: clientRow[CONFIG.CLIENT_COLUMNS.WEBSITE_URL] || '',
                            destinationUrl: clientRow[CONFIG.CLIENT_COLUMNS.DESTINATION_URL] || '',
                            profileImage: clientRow[CONFIG.CLIENT_COLUMNS.PROFILE_IMAGE] || ''
                        };
                    }
                    setClientInfo(extractedClientInfo);

                    if (assetsData.values && assetsData.values.length > 1) {
                        const assets = assetsData.values.slice(1).map((row, index) => ({
                            rowIndex: index + 2,
                            approvalStatus: row[CONFIG.ASSETS_COLUMNS.APPROVAL_STATUS] || 'Pending',
                            adStatus: row[CONFIG.ASSETS_COLUMNS.AD_STATUS] || 'Draft',
                            adName: row[CONFIG.ASSETS_COLUMNS.AD_NAME] || '',
                            description: row[CONFIG.ASSETS_COLUMNS.DESCRIPTION] || '',
                            campaignAngle: row[CONFIG.ASSETS_COLUMNS.CAMPAIGN_ANGLE] || '',
                            headline: row[CONFIG.ASSETS_COLUMNS.HEADLINE] || '',
                            adCopyBody: row[CONFIG.ASSETS_COLUMNS.AD_COPY_BODY] || '',
                            assetUrl: row[CONFIG.ASSETS_COLUMNS.DIRECT_URL] || '',  // Use Direct URL (column I) for images
                            clientNote: row[CONFIG.ASSETS_COLUMNS.CLIENT_NOTE] || ''
                        }));

                        setCreativeAssets(assets);
                    }

                    setLoading(false);
                } catch (err) {
                    console.error('Error:', err);
                    setError(err.message);
                    setLoading(false);
                }
            };

            const updateAssetStatus = async (asset, newStatus) => {
                const notes = editNotes[asset.rowIndex] !== undefined
                    ? editNotes[asset.rowIndex]
                    : (asset.clientNote || '');
                setUpdating(prev => ({ ...prev, [asset.rowIndex]: true }));

                try {
                    await fetch(CONFIG.APPS_SCRIPT_URL, {
                        method: 'POST',
                        mode: 'no-cors',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            action: 'updateApprovalStatus',
                            rowIndex: asset.rowIndex,
                            approvalStatus: newStatus,
                            clientNote: notes
                        })
                    });

                    setCreativeAssets(prev =>
                        prev.map(a =>
                            a.rowIndex === asset.rowIndex
                                ? { ...a, approvalStatus: newStatus, clientNote: notes }
                                : a
                        )
                    );

                    setEditNotes(prev => {
                        const updated = { ...prev };
                        delete updated[asset.rowIndex];
                        return updated;
                    });

                    showNotification(`‚úì Status: ${newStatus}!`, 'success');

                    // Auto-switch to appropriate tab
                    if (newStatus.toLowerCase() === 'approved') {
                        setActiveFilter('approved');
                    } else if (newStatus.toLowerCase() === 'needs edit') {
                        setActiveFilter('needs edit');
                    } else if (newStatus.toLowerCase() === 'rejected') {
                        setActiveFilter('rejected');
                    } else if (newStatus.toLowerCase() === 'pending') {
                        setActiveFilter('pending');
                    }

                } catch (err) {
                    showNotification('‚úó Failed to update', 'error');
                } finally {
                    setUpdating(prev => {
                        const updated = { ...prev };
                        delete updated[asset.rowIndex];
                        return updated;
                    });
                }
            };

            const handleNotesChange = (rowIndex, value) => {
                setEditNotes(prev => ({ ...prev, [rowIndex]: value }));
            };

            const showNotification = (message, type) => {
                const notification = document.createElement('div');
                notification.textContent = message;
                notification.style.cssText = `
                    position: fixed; top: 20px; right: 20px; padding: 16px 24px;
                    background-color: ${type === 'success' ? '#10b981' : '#ef4444'};
                    color: white; border-radius: 8px; box-shadow: 0 4px 12px rgba(0,0,0,0.15);
                    z-index: 9999; animation: slideIn 0.3s ease-out;
                `;
                document.body.appendChild(notification);
                setTimeout(() => {
                    notification.style.animation = 'slideOut 0.3s ease-in';
                    setTimeout(() => notification.remove(), 300);
                }, 3000);
            };

            const getFilteredAssets = () => {
                let filtered = creativeAssets;

                // Filter by approval status
                if (activeFilter !== 'all') {
                    filtered = filtered.filter(asset =>
                        asset.approvalStatus?.toLowerCase() === activeFilter ||
                        (!asset.approvalStatus && activeFilter === 'pending')
                    );
                }

                // Filter by ad status
                if (adStatusFilter !== 'all') {
                    filtered = filtered.filter(asset => {
                        const statusInfo = getAdStatusInfo(asset.adStatus);
                        // Match against the filter ID
                        if (adStatusFilter === 'live' && statusInfo === CONFIG.AD_STATUSES.LIVE) return true;
                        if (adStatusFilter === 'in_draft' && statusInfo === CONFIG.AD_STATUSES.IN_DRAFT) return true;
                        if (adStatusFilter === 'launched_leads_no_calls' && statusInfo === CONFIG.AD_STATUSES.LAUNCHED_LEADS_NO_CALLS) return true;
                        if (adStatusFilter === 'launched_no_leads' && statusInfo === CONFIG.AD_STATUSES.LAUNCHED_NO_LEADS) return true;
                        if (adStatusFilter === 'rejected_by_meta' && statusInfo === CONFIG.AD_STATUSES.REJECTED_BY_META) return true;
                        if (adStatusFilter === 'not_launched' && statusInfo === CONFIG.AD_STATUSES.NOT_LAUNCHED) return true;
                        return false;
                    });
                }

                return filtered;
            };

            const getStats = () => {
                const total = creativeAssets.length;
                const pending = creativeAssets.filter(a => !a.approvalStatus || a.approvalStatus.toLowerCase() === 'pending').length;
                const approved = creativeAssets.filter(a => a.approvalStatus?.toLowerCase() === 'approved').length;
                const needsEdit = creativeAssets.filter(a => a.approvalStatus?.toLowerCase() === 'needs edit').length;
                const rejected = creativeAssets.filter(a => a.approvalStatus?.toLowerCase() === 'rejected').length;

                return { total, pending, approved, needsEdit, rejected };
            };

            if (loading) {
                return (
                    <div style={{
                        display: 'flex', justifyContent: 'center', alignItems: 'center',
                        minHeight: '100vh', flexDirection: 'column', gap: '20px'
                    }}>
                        <div className="spinner"></div>
                        <div style={{ fontSize: '18px', color: '#666' }}>Loading creative assets...</div>
                    </div>
                );
            }

            if (error) {
                return (
                    <div style={{
                        display: 'flex', justifyContent: 'center', alignItems: 'center',
                        minHeight: '100vh', padding: '20px'
                    }}>
                        <div style={{
                            textAlign: 'center', maxWidth: '600px', backgroundColor: 'white',
                            padding: '40px', borderRadius: '12px', boxShadow: '0 4px 12px rgba(0,0,0,0.1)'
                        }}>
                            <div style={{ fontSize: '48px', marginBottom: '16px' }}>‚ö†Ô∏è</div>
                            <h2 style={{ fontSize: '24px', marginBottom: '16px', color: '#ef4444' }}>
                                Connection Error
                            </h2>
                            <div style={{ color: '#666', lineHeight: '1.6' }}>{error}</div>
                        </div>
                    </div>
                );
            }

            const stats = getStats();
            const filteredAssets = getFilteredAssets();

            return (
                <div style={{ minHeight: '100vh', backgroundColor: '#f0f2f5', padding: '20px 40px' }}>
                    <div style={{ maxWidth: '1600px', margin: '0 auto' }}>
                        <div style={{
                            marginBottom: '20px',
                            padding: '20px',
                            backgroundColor: 'white',
                            borderRadius: '12px',
                            boxShadow: '0 2px 8px rgba(0,0,0,0.1)',
                            display: 'flex',
                            justifyContent: 'space-between',
                            alignItems: 'center',
                            flexWrap: 'wrap',
                            gap: '12px'
                        }}>
                            <div>
                                <h1 style={{ fontSize: '28px', fontWeight: '700', color: '#050505', marginBottom: '4px' }}>
                                    üé® Creative Assets Approval
                                </h1>
                                <p style={{ fontSize: '14px', color: '#65676b' }}>
                                    {clientInfo?.businessName || 'Client'}
                                </p>
                            </div>
                            <button
                                onClick={() => window.location.reload()}
                                style={{
                                    padding: '10px 20px',
                                    backgroundColor: '#1877f2',
                                    color: 'white',
                                    border: 'none',
                                    borderRadius: '6px',
                                    fontSize: '14px',
                                    fontWeight: '600',
                                    cursor: 'pointer'
                                }}
                            >
                                üîÑ Refresh
                            </button>
                        </div>

                        <div style={{
                            display: 'grid',
                            gridTemplateColumns: 'repeat(auto-fit, minmax(140px, 1fr))',
                            gap: '12px',
                            marginBottom: '20px'
                        }}>
                            {[
                                { count: stats.total, label: 'Total', color: '#6b7280' },
                                { count: stats.pending, label: 'Pending', color: '#1877f2' },
                                { count: stats.approved, label: 'Approved', color: '#10b981' },
                                { count: stats.needsEdit, label: 'Needs Edit', color: '#f59e0b' },
                                { count: stats.rejected, label: 'Rejected', color: '#ef4444' }
                            ].map((stat, idx) => (
                                <div key={idx} style={{
                                    backgroundColor: 'white',
                                    padding: '16px',
                                    borderRadius: '8px',
                                    boxShadow: '0 1px 3px rgba(0,0,0,0.1)',
                                    textAlign: 'center'
                                }}>
                                    <div style={{ fontSize: '32px', fontWeight: '700', color: stat.color }}>
                                        {stat.count}
                                    </div>
                                    <div style={{ fontSize: '13px', color: '#65676b', marginTop: '4px' }}>
                                        {stat.label}
                                    </div>
                                </div>
                            ))}
                        </div>

                        {/* Approval Status Filter */}
                        <div style={{ marginBottom: '12px' }}>
                            <div style={{ fontSize: '12px', fontWeight: '600', color: '#65676b', marginBottom: '8px', textTransform: 'uppercase' }}>
                                Approval Status
                            </div>
                            <div style={{ display: 'flex', gap: '8px', flexWrap: 'wrap' }}>
                                {[
                                    { id: 'all', label: 'All' },
                                    { id: 'pending', label: 'Pending' },
                                    { id: 'approved', label: 'Approved' },
                                    { id: 'needs edit', label: 'Needs Edit' },
                                    { id: 'rejected', label: 'Rejected' }
                                ].map(tab => (
                                    <button
                                        key={tab.id}
                                        onClick={() => setActiveFilter(tab.id)}
                                        style={{
                                            padding: '8px 16px',
                                            backgroundColor: activeFilter === tab.id ? '#1877f2' : 'white',
                                            color: activeFilter === tab.id ? 'white' : '#65676b',
                                            border: 'none',
                                            borderRadius: '8px',
                                            fontSize: '13px',
                                            fontWeight: '600',
                                            cursor: 'pointer',
                                            boxShadow: '0 1px 3px rgba(0,0,0,0.1)'
                                        }}
                                    >
                                        {tab.label}
                                    </button>
                                ))}
                            </div>
                        </div>

                        {/* Ad Status Filter */}
                        <div style={{ marginBottom: '24px' }}>
                            <div style={{ fontSize: '12px', fontWeight: '600', color: '#65676b', marginBottom: '8px', textTransform: 'uppercase' }}>
                                Ad Status
                            </div>
                            <div style={{ display: 'flex', gap: '8px', flexWrap: 'wrap' }}>
                                {[
                                    { id: 'all', label: 'All', color: '#6b7280' },
                                    { id: 'live', label: 'üü¢ Live', color: '#10b981' },
                                    { id: 'in_draft', label: 'üìù In Draft', color: '#6b7280' },
                                    { id: 'launched_leads_no_calls', label: 'üìû Leads, No Calls', color: '#f59e0b' },
                                    { id: 'launched_no_leads', label: 'üìâ No Leads', color: '#ef4444' },
                                    { id: 'rejected_by_meta', label: 'üö´ Rejected by Meta', color: '#dc2626' },
                                    { id: 'not_launched', label: '‚è∏Ô∏è Not Launched', color: '#9ca3af' }
                                ].map(tab => (
                                    <button
                                        key={tab.id}
                                        onClick={() => setAdStatusFilter(tab.id)}
                                        style={{
                                            padding: '8px 16px',
                                            backgroundColor: adStatusFilter === tab.id ? tab.color : 'white',
                                            color: adStatusFilter === tab.id ? 'white' : '#65676b',
                                            border: 'none',
                                            borderRadius: '8px',
                                            fontSize: '13px',
                                            fontWeight: '600',
                                            cursor: 'pointer',
                                            boxShadow: '0 1px 3px rgba(0,0,0,0.1)'
                                        }}
                                    >
                                        {tab.label}
                                    </button>
                                ))}
                            </div>
                        </div>

                        {filteredAssets.length === 0 ? (
                            <div style={{
                                backgroundColor: 'white',
                                borderRadius: '12px',
                                padding: '60px 20px',
                                textAlign: 'center',
                                boxShadow: '0 2px 8px rgba(0,0,0,0.1)'
                            }}>
                                <div style={{ fontSize: '48px', marginBottom: '16px' }}>üì≠</div>
                                <div style={{ fontSize: '20px', fontWeight: '600', color: '#050505' }}>
                                    No ads found
                                </div>
                                <div style={{ fontSize: '14px', color: '#65676b', marginTop: '8px' }}>
                                    Add creative assets to your sheet
                                </div>
                            </div>
                        ) : (
                            <div style={{
                                display: 'grid',
                                gridTemplateColumns: 'repeat(auto-fill, minmax(380px, 1fr))',
                                gap: '32px'
                            }}>
                                {filteredAssets.map((asset) => (
                                    <CreativeAssetCard
                                        key={asset.rowIndex}
                                        asset={asset}
                                        clientInfo={clientInfo}
                                        updating={updating}
                                        onStatusUpdate={updateAssetStatus}
                                        editNotes={editNotes}
                                        onNotesChange={handleNotesChange}
                                    />
                                ))}
                            </div>
                        )}
                    </div>

                    <style>
                        {`
                            @keyframes slideIn {
                                from { transform: translateX(400px); opacity: 0; }
                                to { transform: translateX(0); opacity: 1; }
                            }
                            @keyframes slideOut {
                                from { transform: translateX(0); opacity: 1; }
                                to { transform: translateX(400px); opacity: 0; }
                            }
                            @media (max-width: 768px) {
                                div[style*="gridTemplateColumns"] {
                                    grid-template-columns: 1fr !important;
                                }
                            }
                        `}
                    </style>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<CreativeApprovalPortal />);
    </script>
</body>
</html>
